(function(){'use strict';const config={rootMargin:'50px 0px',threshold:0.01,enableBlurEffect:true,placeholderClass:'lazy-placeholder',loadedClass:'lazy-loaded',errorClass:'lazy-error'};const supportsIntersectionObserver='IntersectionObserver' in window;function lazyLoadImages(){const lazyImages=document.querySelectorAll('img[loading="lazy"]');if(!supportsIntersectionObserver){lazyImages.forEach(img=>{if(img.dataset.src){img.src=img.dataset.src;}if(img.dataset.srcset){img.srcset=img.dataset.srcset;}});return;}const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;loadImage(img);observer.unobserve(img);}});},{rootMargin:config.rootMargin,threshold:config.threshold});lazyImages.forEach(img=>{if(config.enableBlurEffect){img.classList.add(config.placeholderClass);}imageObserver.observe(img);});}function loadImage(img){const src=img.dataset.src||img.src;const srcset=img.dataset.srcset;const tempImg=new Image();tempImg.onload=function(){if(srcset){img.srcset=srcset;}if(src&&img.dataset.src){img.src=src;}img.classList.remove(config.placeholderClass);img.classList.add(config.loadedClass);delete img.dataset.src;delete img.dataset.srcset;};tempImg.onerror=function(){img.classList.add(config.errorClass);console.warn('Failed to load image:',src);};tempImg.src=src;if(srcset){tempImg.srcset=srcset;}}function lazyLoadBackgrounds(){const lazyBackgrounds=document.querySelectorAll('[data-bg]');if(!supportsIntersectionObserver){lazyBackgrounds.forEach(element=>{element.style.backgroundImage=`url('${element.dataset.bg}')`;delete element.dataset.bg;});return;}const bgObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const element=entry.target;element.style.backgroundImage=`url('${element.dataset.bg}')`;element.classList.add(config.loadedClass);delete element.dataset.bg;observer.unobserve(element);}});},{rootMargin:config.rootMargin,threshold:config.threshold});lazyBackgrounds.forEach(bg=>{bgObserver.observe(bg);});}function preloadCriticalImages(){const criticalImages=document.querySelectorAll('img[loading="eager"]');criticalImages.forEach(img=>{if(img.dataset.src){img.src=img.dataset.src;delete img.dataset.src;}if(img.dataset.srcset){img.srcset=img.dataset.srcset;delete img.dataset.srcset;}});}function handleResponsiveImages(){const responsiveImages=document.querySelectorAll('img[data-src-mobile][data-src-tablet][data-src-desktop]');responsiveImages.forEach(img=>{const viewportWidth=window.innerWidth;let src;if(viewportWidth<640){src=img.dataset.srcMobile;}else if(viewportWidth<1024){src=img.dataset.srcTablet;}else{src=img.dataset.srcDesktop;}if(src){img.dataset.src=src;}});}function addLazyLoadingStyles(){if(document.getElementById('lazy-loading-styles')){return;}const style=document.createElement('style');style.id='lazy-loading-styles';style.textContent=` .lazy-placeholder{filter:blur(10px);transform:scale(1.05);transition:filter 0.3s ease-out,transform 0.3s ease-out;}.lazy-loaded{filter:blur(0);transform:scale(1);animation:fadeIn 0.3s ease-out;}.lazy-error{opacity:0.5;filter:grayscale(100%);}@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}[data-bg]{background-size:cover;background-position:center;background-repeat:no-repeat;}@media(prefers-reduced-motion:reduce){.lazy-placeholder{filter:none;transform:none;transition:none;}.lazy-loaded{animation:none;}}`;document.head.appendChild(style);}function init(){addLazyLoadingStyles();preloadCriticalImages();handleResponsiveImages();lazyLoadImages();lazyLoadBackgrounds();document.addEventListener('contentLoaded',()=>{lazyLoadImages();lazyLoadBackgrounds();});let resizeTimer;window.addEventListener('resize',()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(()=>{handleResponsiveImages();lazyLoadImages();},250);});}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.LazyLoad={init:init,loadImage:loadImage,refresh:function(){lazyLoadImages();lazyLoadBackgrounds();}};})();;(function(){'use strict';const state={theme:localStorage.getItem('theme')||'light',language:document.documentElement.lang||'en',mobileMenuOpen:false,scrolled:false};const DOM={header:document.getElementById('header'),mobileMenuToggle:document.getElementById('mobileMenuToggle'),mobileMenuClose:document.getElementById('mobileMenuClose'),mobileMenuOverlay:document.getElementById('mobileMenuOverlay'),themeToggle:document.getElementById('themeToggle'),langBtn:document.getElementById('langBtn'),langDropdown:document.getElementById('langDropdown'),scrollProgress:document.getElementById('scrollProgress'),backToTop:document.getElementById('backToTop'),navLinks:document.querySelectorAll('.nav-link,.mobile-nav-link'),body:document.body};function initTheme(){document.body.setAttribute('data-theme',state.theme);if(DOM.themeToggle){DOM.themeToggle.addEventListener('click',toggleTheme);}}function toggleTheme(){state.theme=state.theme==='light'?'dark':'light';document.body.setAttribute('data-theme',state.theme);localStorage.setItem('theme',state.theme);trackEvent('theme_changed',{theme:state.theme});}function initMobileMenu(){if(DOM.mobileMenuToggle){DOM.mobileMenuToggle.addEventListener('click',toggleMobileMenu);}if(DOM.mobileMenuClose){DOM.mobileMenuClose.addEventListener('click',closeMobileMenu);}if(DOM.mobileMenuOverlay){DOM.mobileMenuOverlay.addEventListener('click',function(e){if(e.target===DOM.mobileMenuOverlay){closeMobileMenu();}});}document.querySelectorAll('.mobile-nav-link').forEach(link=>{link.addEventListener('click',closeMobileMenu);});}function toggleMobileMenu(){state.mobileMenuOpen=!state.mobileMenuOpen;if(state.mobileMenuOpen){openMobileMenu();}else{closeMobileMenu();}}function openMobileMenu(){DOM.mobileMenuOverlay.classList.add('active');DOM.body.style.overflow='hidden';trackEvent('mobile_menu_opened');}function closeMobileMenu(){state.mobileMenuOpen=false;DOM.mobileMenuOverlay.classList.remove('active');DOM.body.style.overflow='';trackEvent('mobile_menu_closed');}function initSmoothScroll(){DOM.navLinks.forEach(link=>{link.addEventListener('click',function(e){const href=this.getAttribute('href');if(href&&href.startsWith('#')){e.preventDefault();const targetId=href.substring(1);const targetElement=document.getElementById(targetId);if(targetElement){const headerHeight=DOM.header?DOM.header.offsetHeight:80;const targetPosition=targetElement.offsetTop-headerHeight;window.scrollTo({top:targetPosition,behavior:'smooth'});updateActiveNavLink(this);trackEvent('navigation_click',{target:targetId});}}});});}function updateActiveNavLink(activeLink){DOM.navLinks.forEach(link=>link.classList.remove('active'));activeLink.classList.add('active');const section=activeLink.getAttribute('data-section');if(section){document.querySelectorAll(`[data-section="${section}"]`).forEach(link=>{link.classList.add('active');});}}function initScrollHandlers(){let ticking=false;window.addEventListener('scroll',function(){if(!ticking){window.requestAnimationFrame(function(){handleScroll();ticking=false;});ticking=true;}});handleScroll();}function handleScroll(){const scrollTop=window.pageYOffset||document.documentElement.scrollTop;const scrollHeight=document.documentElement.scrollHeight-window.innerHeight;const scrollPercent=(scrollTop/scrollHeight)*100;if(DOM.scrollProgress){DOM.scrollProgress.style.width=scrollPercent+'%';}if(scrollTop>50&&!state.scrolled){state.scrolled=true;DOM.header?.classList.add('scrolled');}else if(scrollTop<=50&&state.scrolled){state.scrolled=false;DOM.header?.classList.remove('scrolled');}if(DOM.backToTop){if(scrollTop>300){DOM.backToTop.classList.add('visible');}else{DOM.backToTop.classList.remove('visible');}}updateActiveSection();}function updateActiveSection(){const sections=document.querySelectorAll('section[id]');const scrollPos=window.pageYOffset+200;sections.forEach(section=>{const sectionTop=section.offsetTop;const sectionHeight=section.offsetHeight;const sectionId=section.getAttribute('id');if(scrollPos>=sectionTop&&scrollPos<sectionTop+sectionHeight){DOM.navLinks.forEach(link=>{const linkSection=link.getAttribute('data-section');if(linkSection===sectionId){link.classList.add('active');}else{link.classList.remove('active');}});}});}function initBackToTop(){if(DOM.backToTop){DOM.backToTop.addEventListener('click',function(){window.scrollTo({top:0,behavior:'smooth'});trackEvent('back_to_top_clicked');});}}function initScrollReveal(){const revealElements=document.querySelectorAll('.scroll-reveal,.scroll-reveal-left,.scroll-reveal-right,.scroll-reveal-scale');const observerOptions={threshold:0.15,rootMargin:'0px 0px-100px 0px'};const observer=new IntersectionObserver(function(entries){entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('revealed');}});},observerOptions);revealElements.forEach(el=>observer.observe(el));}function initForms(){const newsletterForm=document.getElementById('newsletterForm');if(newsletterForm){newsletterForm.addEventListener('submit',handleNewsletterSubmit);}const contactForm=document.getElementById('contactForm');if(contactForm){contactForm.addEventListener('submit',handleContactSubmit);}const bookingForm=document.getElementById('bookingForm');if(bookingForm){bookingForm.addEventListener('submit',handleBookingSubmit);}}async function handleNewsletterSubmit(e){e.preventDefault();const form=e.target;const formData=new FormData(form);const submitBtn=form.querySelector('button[type="submit"]');try{submitBtn.disabled=true;submitBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i><span>Subscribing...</span>';const response=await fetch('/handlers/newsletter.php',{method:'POST',body:formData});const result=await response.json();if(result.success){showNotification('success',result.message||'Successfully subscribed!');form.reset();trackEvent('newsletter_subscribed',{email:formData.get('email')});}else{showNotification('error',result.message||'Subscription failed');}}catch(error){console.error('Newsletter error:',error);showNotification('error','An error occurred. Please try again.');}finally{submitBtn.disabled=false;submitBtn.innerHTML='<i class="fa-solid fa-paper-plane"></i><span>Subscribe</span>';}}async function handleContactSubmit(e){e.preventDefault();const form=e.target;const formData=new FormData(form);const submitBtn=form.querySelector('button[type="submit"]');try{submitBtn.disabled=true;submitBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>Sending...';const response=await fetch('/handlers/contact-form.php',{method:'POST',body:formData});const result=await response.json();if(result.success){showNotification('success',result.message||'Message sent successfully!');form.reset();trackEvent('contact_form_submitted');}else{showNotification('error',result.message||'Failed to send message');}}catch(error){console.error('Contact form error:',error);showNotification('error','An error occurred. Please try again.');}finally{submitBtn.disabled=false;submitBtn.innerHTML='<i class="fa-solid fa-paper-plane"></i>Send Message';}}async function handleBookingSubmit(e){e.preventDefault();const form=e.target;const formData=new FormData(form);const submitBtn=form.querySelector('button[type="submit"]');try{submitBtn.disabled=true;submitBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>Creating Booking...';const response=await fetch('/handlers/booking-handler.php',{method:'POST',body:formData});const result=await response.json();if(result.success){showNotification('success',result.message||'Booking created successfully!');form.reset();trackEvent('booking_created',{bookingId:result.data?.booking_id});if(result.data?.booking_id){setTimeout(()=>{window.location.href=`/booking-confirmation.php?id=${result.data.booking_id}`;},2000);}}else{showNotification('error',result.message||'Failed to create booking');}}catch(error){console.error('Booking error:',error);showNotification('error','An error occurred. Please try again.');}finally{submitBtn.disabled=false;submitBtn.innerHTML='<i class="fa-solid fa-calendar-check"></i>Book Now';}}function showNotification(type,message,duration=5000){const existing=document.querySelector('.notification');if(existing){existing.remove();}const notification=document.createElement('div');notification.className=`notification notification-${type}`;const icon=type==='success'?'fa-check-circle':type==='error'?'fa-exclamation-circle':'fa-info-circle';notification.innerHTML=`<i class="fa-solid ${icon}"></i><span>${message}</span><button class="notification-close"><i class="fa-solid fa-times"></i></button>`;document.body.appendChild(notification);setTimeout(()=>notification.classList.add('show'),100);const hideTimeout=setTimeout(()=>hideNotification(notification),duration);notification.querySelector('.notification-close').addEventListener('click',()=>{clearTimeout(hideTimeout);hideNotification(notification);});}function hideNotification(notification){notification.classList.remove('show');setTimeout(()=>notification.remove(),300);}function trackEvent(eventType,details={}){if(typeof fetch!=='undefined'){fetch('/api/track-event.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({event_type:eventType,details:details,timestamp:new Date().toISOString()})}).catch(err=>console.error('Analytics error:',err));}if(typeof gtag!=='undefined'){gtag('event',eventType,details);}}function initVisibilityTracking(){let startTime=Date.now();document.addEventListener('visibilitychange',function(){if(document.hidden){const timeSpent=Date.now()-startTime;trackEvent('page_hidden',{time_spent:Math.round(timeSpent/1000)});}else{startTime=Date.now();trackEvent('page_visible');}});}function initLazyLoading(){const lazyImages=document.querySelectorAll('img[data-src],iframe[data-src]');if('IntersectionObserver' in window){const imageObserver=new IntersectionObserver(function(entries){entries.forEach(entry=>{if(entry.isIntersecting){const element=entry.target;const src=element.getAttribute('data-src');if(src){element.src=src;element.removeAttribute('data-src');element.classList.add('loaded');}imageObserver.unobserve(element);}});});lazyImages.forEach(img=>imageObserver.observe(img));}else{lazyImages.forEach(element=>{const src=element.getAttribute('data-src');if(src){element.src=src;element.removeAttribute('data-src');}});}}function initCounters(){const counters=document.querySelectorAll('[data-count]');if(counters.length===0)return;const counterObserver=new IntersectionObserver(function(entries){entries.forEach(entry=>{if(entry.isIntersecting){animateCounter(entry.target);counterObserver.unobserve(entry.target);}});},{threshold:0.5});counters.forEach(counter=>counterObserver.observe(counter));}function animateCounter(element){const target=parseInt(element.getAttribute('data-count'));const duration=2000;const start=0;const increment=target/(duration/16);let current=start;const timer=setInterval(()=>{current+=increment;if(current>=target){element.textContent=target.toLocaleString();clearInterval(timer);}else{element.textContent=Math.floor(current).toLocaleString();}},16);}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}function throttle(func,limit){let inThrottle;return function(...args){if(!inThrottle){func.apply(this,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};}function init(){console.log('Fast&Fine-Initializing...');initTheme();initMobileMenu();initSmoothScroll();initScrollHandlers();initBackToTop();initScrollReveal();initForms();initLazyLoading();initCounters();initVisibilityTracking();trackEvent('page_loaded',{page:window.location.pathname,referrer:document.referrer});console.log('Fast&Fine-Ready!');}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.FastAndFine={trackEvent,showNotification,toggleTheme,openMobileMenu,closeMobileMenu};})();;(function(){'use strict';const state={currentCategory:'all',searchQuery:'',servicesData:[],currentLanguage:document.documentElement.lang||'en'};const elements={servicesGrid:document.getElementById('servicesGrid'),filterBtns:document.querySelectorAll('.filter-btn'),searchInput:document.getElementById('serviceSearchInput'),searchClearBtn:document.getElementById('searchClearBtn'),noResults:document.getElementById('noResults'),resetSearchBtn:document.getElementById('resetSearchBtn'),serviceModal:document.getElementById('serviceModal'),serviceModalOverlay:document.getElementById('serviceModalOverlay'),serviceModalClose:document.getElementById('serviceModalClose'),serviceModalBody:document.getElementById('serviceModalBody'),serviceModalTitle:document.getElementById('serviceModalTitle'),viewDetailsBtns:document.querySelectorAll('.view-details-btn')};function init(){loadServicesData();attachEventListeners();initFlipCards();}function loadServicesData(){const servicesDataElement=document.getElementById('servicesData');if(servicesDataElement){try{state.servicesData=JSON.parse(servicesDataElement.textContent);}catch(error){console.error('Error parsing services data:',error);}}}function attachEventListeners(){elements.filterBtns.forEach(btn=>{btn.addEventListener('click',handleCategoryFilter);});if(elements.searchInput){elements.searchInput.addEventListener('input',debounce(handleSearch,300));elements.searchInput.addEventListener('keyup',function(e){if(e.key==='Escape'){clearSearch();}});}if(elements.searchClearBtn){elements.searchClearBtn.addEventListener('click',clearSearch);}if(elements.resetSearchBtn){elements.resetSearchBtn.addEventListener('click',resetFilters);}elements.viewDetailsBtns.forEach(btn=>{btn.addEventListener('click',function(){const serviceId=this.getAttribute('data-service-id');openServiceModal(serviceId);});});attachViewDetailsListeners();if(elements.serviceModalClose){elements.serviceModalClose.addEventListener('click',closeServiceModal);}if(elements.serviceModalOverlay){elements.serviceModalOverlay.addEventListener('click',closeServiceModal);}document.addEventListener('keydown',function(e){if(e.key==='Escape'&&elements.serviceModal&&elements.serviceModal.classList.contains('active')){closeServiceModal();}});}function attachViewDetailsListeners(){const viewDetailsBtns=document.querySelectorAll('.view-details-btn');viewDetailsBtns.forEach(btn=>{btn.removeEventListener('click',handleViewDetails);btn.addEventListener('click',handleViewDetails);});}function handleViewDetails(e){e.preventDefault();e.stopPropagation();const serviceId=this.getAttribute('data-service-id');openServiceModal(serviceId);}function initFlipCards(){const flipCards=document.querySelectorAll('.service-flip-card');flipCards.forEach(card=>{card.addEventListener('touchstart',function(e){if(!e.target.closest('.view-details-btn')&&!e.target.closest('.btn')){this.classList.toggle('flipped');}});card.setAttribute('tabindex','0');card.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();this.classList.toggle('flipped');}});});}function handleCategoryFilter(e){const category=this.getAttribute('data-category');state.currentCategory=category;elements.filterBtns.forEach(btn=>btn.classList.remove('active'));this.classList.add('active');filterServices();if(typeof trackEvent==='function'){trackEvent('service_filter',{category:category});}}function handleSearch(e){state.searchQuery=e.target.value.toLowerCase().trim();if(elements.searchClearBtn){elements.searchClearBtn.style.display=state.searchQuery?'flex':'none';}filterServices();if(typeof trackEvent==='function'&&state.searchQuery){trackEvent('service_search',{query:state.searchQuery});}}function clearSearch(){if(elements.searchInput){elements.searchInput.value='';state.searchQuery='';}if(elements.searchClearBtn){elements.searchClearBtn.style.display='none';}filterServices();}function resetFilters(){state.currentCategory='all';state.searchQuery='';elements.filterBtns.forEach(btn=>btn.classList.remove('active'));const allBtn=document.querySelector('.filter-btn[data-category="all"]');if(allBtn){allBtn.classList.add('active');}if(elements.searchInput){elements.searchInput.value='';}if(elements.searchClearBtn){elements.searchClearBtn.style.display='none';}filterServices();}function filterServices(){const cards=document.querySelectorAll('.service-flip-card');let visibleCount=0;cards.forEach(card=>{const category=card.getAttribute('data-category');const serviceName=card.getAttribute('data-service-name').toLowerCase();const categoryMatch=state.currentCategory==='all'||category===state.currentCategory;const searchMatch=!state.searchQuery||serviceName.includes(state.searchQuery);if(categoryMatch&&searchMatch){card.style.display='block';card.classList.remove('flipped');setTimeout(()=>{card.style.opacity='1';card.style.transform='translateY(0)';},visibleCount*50);visibleCount++;}else{card.style.display='none';card.style.opacity='0';card.style.transform='translateY(20px)';}});if(elements.noResults){if(visibleCount===0){elements.noResults.style.display='flex';elements.servicesGrid.style.display='none';}else{elements.noResults.style.display='none';elements.servicesGrid.style.display='grid';}}}function openServiceModal(serviceId){const service=state.servicesData.find(s=>s.id==serviceId);if(!service){console.error('Service not found:',serviceId);return;}const name=state.currentLanguage==='ar'?service.name_ar:service.name_en;const longDesc=state.currentLanguage==='ar'?service.long_desc_ar:service.long_desc_en;const features=state.currentLanguage==='ar'?service.features_ar:service.features_en;const modalContent=`<div class="service-detail"><div class="service-detail-header"><div class="service-icon-modal"><i class="${escapeHTML(service.icon_class)}"></i></div><div class="service-detail-title"><h2>${escapeHTML(name)}</h2><span class="category-badge badge-${escapeHTML(service.category)}">${escapeHTML(service.category)}</span></div></div><div class="service-detail-body"><div class="service-description"><h4><i class="fa-solid fa-info-circle"></i>${getTranslation('description')}</h4><p>${escapeHTML(longDesc)}</p></div>${features&&features.length>0?`<div class="service-features-full"><h4><i class="fa-solid fa-list-check"></i>${getTranslation('features_included')}</h4><ul class="features-grid">${features.map(feature=>`<li><i class="fa-solid fa-check-circle"></i><span>${escapeHTML(feature)}</span></li>`).join('')}</ul></div>`:''}<div class="service-pricing"><h4><i class="fa-solid fa-dollar-sign"></i>${getTranslation('pricing')}</h4><div class="price-info"><span class="price-label">${getTranslation('starting_from')}:</span><span class="price-value">${formatPrice(service.starting_price)}</span><p class="price-note">${getTranslation('price_varies_note')}</p></div></div><div class="service-cta-box"><i class="fa-solid fa-headset"></i><div class="cta-box-content"><h4>${getTranslation('ready_to_book')}</h4><p>${getTranslation('ready_to_book_desc')}</p></div></div></div></div>`;if(elements.serviceModalTitle){elements.serviceModalTitle.textContent=name;}if(elements.serviceModalBody){elements.serviceModalBody.innerHTML=modalContent;}const modalBookBtn=document.getElementById('modalBookNowBtn');const modalQuoteBtn=document.getElementById('modalGetQuoteBtn');if(modalBookBtn){modalBookBtn.href=`#booking?service=${serviceId}`;}if(modalQuoteBtn){modalQuoteBtn.href=`#quote?service=${serviceId}`;}if(elements.serviceModal){elements.serviceModal.classList.add('active');document.body.style.overflow='hidden';if(typeof trackEvent==='function'){trackEvent('service_detail_view',{service_id:serviceId,service_name:name});}}}function closeServiceModal(){if(elements.serviceModal){elements.serviceModal.classList.remove('active');document.body.style.overflow='';}}function formatPrice(price){return new Intl.NumberFormat('en-AE',{style:'currency',currency:'AED',minimumFractionDigits:0}).format(price);}function escapeHTML(str){const div=document.createElement('div');div.textContent=str||'';return div.innerHTML;}function getTranslation(key){const translations={'description':state.currentLanguage==='ar'?'الوصف':'Description','features_included':state.currentLanguage==='ar'?'المميزات المتضمنة':'Features Included','pricing':state.currentLanguage==='ar'?'التسعير':'Pricing','starting_from':state.currentLanguage==='ar'?'تبدأ من':'Starting from','price_varies_note':state.currentLanguage==='ar'?'قد تختلف الأسعار حسب حجم المشروع ومتطلباته':'Prices may vary based on project size and requirements','ready_to_book':state.currentLanguage==='ar'?'هل أنت مستعد للحجز؟':'Ready to Book?','ready_to_book_desc':state.currentLanguage==='ar'?'فريقنا متاح على مدار الساعة لمساعدتك':'Our team is available 24/7 to assist you'};return translations[key]||key;}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func.apply(this,args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.ServicesModule={openServiceModal,closeServiceModal,filterServices,resetFilters};})();;(function(){'use strict';const state={currentCategory:'all',currentView:'masonry',visibleItems:9,itemsPerPage:6,portfolioData:[],currentLanguage:document.documentElement.lang||'en',lightboxImages:[],lightboxCurrentIndex:0,beforeAfterDragging:false};const elements={portfolioGrid:document.getElementById('portfolioGrid'),filterBtns:document.querySelectorAll('.portfolio-filter .filter-btn'),viewBtns:document.querySelectorAll('.view-toggle .view-btn'),noResults:document.getElementById('noPortfolioResults'),resetBtn:document.getElementById('resetPortfolioBtn'),loadMoreBtn:document.getElementById('loadMoreBtn'),loadMoreContainer:document.getElementById('loadMoreContainer'),projectModal:document.getElementById('projectModal'),projectModalOverlay:document.getElementById('projectModalOverlay'),projectModalClose:document.getElementById('projectModalClose'),projectModalBody:document.getElementById('projectModalBody'),projectModalTitle:document.getElementById('projectModalTitle'),lightbox:document.getElementById('galleryLightbox'),lightboxOverlay:document.getElementById('lightboxOverlay'),lightboxClose:document.getElementById('lightboxClose'),lightboxImage:document.getElementById('lightboxImage'),lightboxContent:document.getElementById('lightboxContent'),lightboxCaption:document.getElementById('lightboxCaption'),lightboxPrev:document.getElementById('lightboxPrev'),lightboxNext:document.getElementById('lightboxNext'),lightboxCurrentIndex:document.getElementById('lightboxCurrentIndex'),lightboxTotalCount:document.getElementById('lightboxTotalCount'),beforeAfterModal:document.getElementById('beforeAfterModal'),beforeAfterOverlay:document.getElementById('beforeAfterOverlay'),beforeAfterClose:document.getElementById('beforeAfterClose'),beforeAfterSlider:document.getElementById('beforeAfterSlider'),beforeImage:document.getElementById('beforeImage'),afterImage:document.getElementById('afterImage'),sliderHandle:document.getElementById('sliderHandle')};function init(){loadPortfolioData();attachEventListeners();initMasonryLayout();updateVisibility();}function loadPortfolioData(){const portfolioDataElement=document.getElementById('portfolioData');if(portfolioDataElement){try{state.portfolioData=JSON.parse(portfolioDataElement.textContent);}catch(error){console.error('Error parsing portfolio data:',error);}}}function attachEventListeners(){elements.filterBtns.forEach(btn=>{btn.addEventListener('click',handleCategoryFilter);});elements.viewBtns.forEach(btn=>{btn.addEventListener('click',handleViewToggle);});if(elements.resetBtn){elements.resetBtn.addEventListener('click',resetFilters);}if(elements.loadMoreBtn){elements.loadMoreBtn.addEventListener('click',loadMoreProjects);}attachViewButtons();if(elements.projectModalClose){elements.projectModalClose.addEventListener('click',closeProjectModal);}if(elements.projectModalOverlay){elements.projectModalOverlay.addEventListener('click',closeProjectModal);}if(elements.lightboxClose){elements.lightboxClose.addEventListener('click',closeLightbox);}if(elements.lightboxOverlay){elements.lightboxOverlay.addEventListener('click',closeLightbox);}if(elements.lightboxPrev){elements.lightboxPrev.addEventListener('click',()=>navigateLightbox(-1));}if(elements.lightboxNext){elements.lightboxNext.addEventListener('click',()=>navigateLightbox(1));}if(elements.beforeAfterClose){elements.beforeAfterClose.addEventListener('click',closeBeforeAfterModal);}if(elements.beforeAfterOverlay){elements.beforeAfterOverlay.addEventListener('click',closeBeforeAfterModal);}if(elements.sliderHandle){initBeforeAfterSlider();}document.addEventListener('keydown',handleKeyboardNavigation);let resizeTimer;window.addEventListener('resize',()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(()=>{if(state.currentView==='masonry'){initMasonryLayout();}},250);});}function attachViewButtons(){const detailsBtns=document.querySelectorAll('.view-details-btn');detailsBtns.forEach(btn=>{btn.removeEventListener('click',handleViewDetails);btn.addEventListener('click',handleViewDetails);});const galleryBtns=document.querySelectorAll('.view-gallery-btn');galleryBtns.forEach(btn=>{btn.removeEventListener('click',handleViewGallery);btn.addEventListener('click',handleViewGallery);});const beforeAfterBtns=document.querySelectorAll('.view-before-after-btn');beforeAfterBtns.forEach(btn=>{btn.removeEventListener('click',handleViewBeforeAfter);btn.addEventListener('click',handleViewBeforeAfter);});}function handleCategoryFilter(e){const category=this.getAttribute('data-category');state.currentCategory=category;state.visibleItems=9;elements.filterBtns.forEach(btn=>btn.classList.remove('active'));this.classList.add('active');filterProjects();if(typeof trackEvent==='function'){trackEvent('portfolio_filter',{category:category});}}function handleViewToggle(e){const view=this.getAttribute('data-view');state.currentView=view;elements.viewBtns.forEach(btn=>btn.classList.remove('active'));this.classList.add('active');if(elements.portfolioGrid){if(view==='masonry'){elements.portfolioGrid.classList.add('masonry-grid');elements.portfolioGrid.classList.remove('standard-grid');setTimeout(()=>initMasonryLayout(),100);}else{elements.portfolioGrid.classList.remove('masonry-grid');elements.portfolioGrid.classList.add('standard-grid');}}}function filterProjects(){const items=document.querySelectorAll('.portfolio-item');let visibleCount=0;let shownCount=0;items.forEach((item,index)=>{const category=item.getAttribute('data-category');const categoryMatch=state.currentCategory==='all'||category===state.currentCategory;if(categoryMatch){visibleCount++;if(visibleCount<=state.visibleItems){item.style.display='block';setTimeout(()=>{item.style.opacity='1';item.style.transform='translateY(0)';},shownCount*50);shownCount++;}else{item.style.display='none';}}else{item.style.display='none';item.style.opacity='0';item.style.transform='translateY(20px)';}});if(elements.noResults){if(visibleCount===0){elements.noResults.style.display='flex';if(elements.portfolioGrid){elements.portfolioGrid.style.display='none';}if(elements.loadMoreContainer){elements.loadMoreContainer.style.display='none';}}else{elements.noResults.style.display='none';if(elements.portfolioGrid){elements.portfolioGrid.style.display='grid';}}}updateLoadMoreButton(visibleCount);if(state.currentView==='masonry'){setTimeout(()=>initMasonryLayout(),100);}attachViewButtons();}function updateLoadMoreButton(totalVisible){if(elements.loadMoreContainer){if(totalVisible>state.visibleItems){elements.loadMoreContainer.style.display='flex';}else{elements.loadMoreContainer.style.display='none';}}}function loadMoreProjects(){state.visibleItems+=state.itemsPerPage;filterProjects();if(typeof trackEvent==='function'){trackEvent('portfolio_load_more',{items:state.visibleItems});}}function resetFilters(){state.currentCategory='all';state.visibleItems=9;elements.filterBtns.forEach(btn=>btn.classList.remove('active'));const allBtn=document.querySelector('.portfolio-filter .filter-btn[data-category="all"]');if(allBtn){allBtn.classList.add('active');}filterProjects();}function updateVisibility(){filterProjects();}function initMasonryLayout(){if(!elements.portfolioGrid||!elements.portfolioGrid.classList.contains('masonry-grid')){return;}const items=Array.from(elements.portfolioGrid.querySelectorAll('.portfolio-item:not([style*="display:none"])'));const gap=30;const columns=getColumnCount();const columnHeights=Array(columns).fill(0);const gridWidth=elements.portfolioGrid.offsetWidth;const itemWidth=(gridWidth-(gap*(columns-1)))/columns;items.forEach(item=>{const shortestColumn=columnHeights.indexOf(Math.min(...columnHeights));const x=shortestColumn*(itemWidth+gap);const y=columnHeights[shortestColumn];item.style.position='absolute';item.style.left=`${x}px`;item.style.top=`${y}px`;item.style.width=`${itemWidth}px`;columnHeights[shortestColumn]+=item.offsetHeight+gap;});const tallestColumn=Math.max(...columnHeights);elements.portfolioGrid.style.height=`${tallestColumn}px`;elements.portfolioGrid.style.position='relative';}function getColumnCount(){const width=window.innerWidth;if(width>=1024)return 3;if(width>=768)return 2;return 1;}function handleViewDetails(e){e.preventDefault();e.stopPropagation();const projectId=this.getAttribute('data-project-id');openProjectModal(projectId);}function handleViewGallery(e){e.preventDefault();e.stopPropagation();const projectId=this.getAttribute('data-project-id');openGalleryLightbox(projectId);}function handleViewBeforeAfter(e){e.preventDefault();e.stopPropagation();const projectId=this.getAttribute('data-project-id');openBeforeAfterModal(projectId);}function openProjectModal(projectId){const project=state.portfolioData.find(p=>p.id==projectId);if(!project){console.error('Project not found:',projectId);return;}const title=state.currentLanguage==='ar'?project.title_ar:project.title_en;const description=state.currentLanguage==='ar'?project.description_ar:project.description_en;const serviceName=state.currentLanguage==='ar'?project.service_name_ar:project.service_name_en;const modalContent=`<div class="project-detail"><div class="project-detail-header"><img src="${escapeHTML(project.main_image)}" alt="${escapeHTML(title)}" class="project-main-image"></div><div class="project-detail-body"><div class="project-meta-grid"><div class="meta-item"><i class="${escapeHTML(project.icon_class)}"></i><div><span class="meta-label">${getTranslation('service')}</span><span class="meta-value">${escapeHTML(serviceName)}</span></div></div><div class="meta-item"><i class="fa-solid fa-map-marker-alt"></i><div><span class="meta-label">${getTranslation('location')}</span><span class="meta-value">${escapeHTML(project.location)}</span></div></div><div class="meta-item"><i class="fa-regular fa-calendar"></i><div><span class="meta-label">${getTranslation('completed')}</span><span class="meta-value">${formatDate(project.completion_date)}</span></div></div>${project.project_duration?`<div class="meta-item"><i class="fa-solid fa-clock"></i><div><span class="meta-label">${getTranslation('duration')}</span><span class="meta-value">${escapeHTML(project.project_duration)}</span></div></div>`:''}</div><div class="project-description"><h4><i class="fa-solid fa-info-circle"></i>${getTranslation('project_description')}</h4><p>${escapeHTML(description)}</p></div>${project.gallery_images&&project.gallery_images.length>0?`<div class="project-gallery-preview"><h4><i class="fa-solid fa-images"></i>${getTranslation('project_gallery')}</h4><div class="gallery-grid">${project.gallery_images.slice(0,4).map((img,index)=>`<img src="${escapeHTML(img)}" alt="${escapeHTML(title)}-${index+1}" class="gallery-thumb" data-index="${index}">`).join('')}${project.gallery_images.length>4?`<div class="gallery-more"><span>+${project.gallery_images.length-4}more</span></div>`:''}</div><button class="btn btn-outline view-all-photos-btn" data-project-id="${project.id}"><i class="fa-solid fa-expand"></i><span>${getTranslation('view_all_photos')}</span></button></div>`:''}<div class="project-cta"><p>${getTranslation('interested_similar_project')}</p><div class="cta-buttons"><a href="#booking" class="btn btn-primary"><i class="fa-solid fa-calendar-check"></i><span>${getTranslation('book_now')}</span></a><a href="#quote" class="btn btn-outline"><i class="fa-solid fa-calculator"></i><span>${getTranslation('get_quote')}</span></a></div></div></div></div>`;if(elements.projectModalTitle){elements.projectModalTitle.textContent=title;}if(elements.projectModalBody){elements.projectModalBody.innerHTML=modalContent;const galleryThumbs=elements.projectModalBody.querySelectorAll('.gallery-thumb');galleryThumbs.forEach(thumb=>{thumb.addEventListener('click',()=>{const index=parseInt(thumb.getAttribute('data-index'));openGalleryLightbox(projectId,index);});});const viewAllBtn=elements.projectModalBody.querySelector('.view-all-photos-btn');if(viewAllBtn){viewAllBtn.addEventListener('click',()=>openGalleryLightbox(projectId));}}if(elements.projectModal){elements.projectModal.classList.add('active');document.body.style.overflow='hidden';if(typeof trackEvent==='function'){trackEvent('project_detail_view',{project_id:projectId,project_title:title});}}}function closeProjectModal(){if(elements.projectModal){elements.projectModal.classList.remove('active');document.body.style.overflow='';}}function openGalleryLightbox(projectId,startIndex=0){const project=state.portfolioData.find(p=>p.id==projectId);if(!project||!project.gallery_images||project.gallery_images.length===0){console.error('No gallery images found for project:',projectId);return;}state.lightboxImages=project.gallery_images;state.lightboxCurrentIndex=startIndex;showLightboxImage();if(elements.lightbox){elements.lightbox.classList.add('active');document.body.style.overflow='hidden';}if(typeof trackEvent==='function'){trackEvent('gallery_view',{project_id:projectId});}}function showLightboxImage(){if(!state.lightboxImages||state.lightboxImages.length===0)return;const currentImage=state.lightboxImages[state.lightboxCurrentIndex];if(elements.lightboxImage){elements.lightboxImage.src=currentImage;elements.lightboxImage.alt=`Image ${state.lightboxCurrentIndex+1}`;}if(elements.lightboxCurrentIndex){elements.lightboxCurrentIndex.textContent=state.lightboxCurrentIndex+1;}if(elements.lightboxTotalCount){elements.lightboxTotalCount.textContent=state.lightboxImages.length;}if(elements.lightboxPrev){elements.lightboxPrev.style.display=state.lightboxCurrentIndex>0?'flex':'none';}if(elements.lightboxNext){elements.lightboxNext.style.display=state.lightboxCurrentIndex<state.lightboxImages.length-1?'flex':'none';}}function navigateLightbox(direction){const newIndex=state.lightboxCurrentIndex+direction;if(newIndex>=0&&newIndex<state.lightboxImages.length){state.lightboxCurrentIndex=newIndex;showLightboxImage();}}function closeLightbox(){if(elements.lightbox){elements.lightbox.classList.remove('active');document.body.style.overflow='';}state.lightboxImages=[];state.lightboxCurrentIndex=0;}function openBeforeAfterModal(projectId){const project=state.portfolioData.find(p=>p.id==projectId);if(!project||!project.before_image||!project.after_image){console.error('Before/after images not found for project:',projectId);return;}if(elements.beforeImage){elements.beforeImage.src=project.before_image;}if(elements.afterImage){elements.afterImage.src=project.after_image;}if(elements.beforeAfterModal){elements.beforeAfterModal.classList.add('active');document.body.style.overflow='hidden';setTimeout(()=>{updateSliderPosition(50);},100);}if(typeof trackEvent==='function'){trackEvent('before_after_view',{project_id:projectId});}}function closeBeforeAfterModal(){if(elements.beforeAfterModal){elements.beforeAfterModal.classList.remove('active');document.body.style.overflow='';}}function initBeforeAfterSlider(){if(!elements.beforeAfterSlider||!elements.sliderHandle)return;const slider=elements.beforeAfterSlider;const handle=elements.sliderHandle;handle.addEventListener('mousedown',startDragging);document.addEventListener('mousemove',drag);document.addEventListener('mouseup',stopDragging);handle.addEventListener('touchstart',startDragging);document.addEventListener('touchmove',drag);document.addEventListener('touchend',stopDragging);slider.addEventListener('click',(e)=>{if(e.target!==handle&&!handle.contains(e.target)){const rect=slider.getBoundingClientRect();const x=e.clientX-rect.left;const percent=(x/rect.width)*100;updateSliderPosition(percent);}});}function startDragging(e){e.preventDefault();state.beforeAfterDragging=true;}function drag(e){if(!state.beforeAfterDragging)return;const slider=elements.beforeAfterSlider;if(!slider)return;const rect=slider.getBoundingClientRect();const x=(e.clientX||e.touches[0].clientX)-rect.left;const percent=Math.max(0,Math.min(100,(x/rect.width)*100));updateSliderPosition(percent);}function stopDragging(){state.beforeAfterDragging=false;}function updateSliderPosition(percent){if(!elements.sliderHandle||!elements.beforeAfterSlider)return;const afterContainer=elements.beforeAfterSlider.querySelector('.after-image-container');if(afterContainer){afterContainer.style.clipPath=`inset(0 ${100-percent}%0 0)`;}elements.sliderHandle.style.left=`${percent}%`;}function handleKeyboardNavigation(e){if(elements.lightbox&&elements.lightbox.classList.contains('active')){if(e.key==='Escape'){closeLightbox();}else if(e.key==='ArrowLeft'){navigateLightbox(-1);}else if(e.key==='ArrowRight'){navigateLightbox(1);}}if(elements.projectModal&&elements.projectModal.classList.contains('active')){if(e.key==='Escape'){closeProjectModal();}}if(elements.beforeAfterModal&&elements.beforeAfterModal.classList.contains('active')){if(e.key==='Escape'){closeBeforeAfterModal();}}}function escapeHTML(str){const div=document.createElement('div');div.textContent=str||'';return div.innerHTML;}function getTranslation(key){const translations={'service':state.currentLanguage==='ar'?'الخدمة':'Service','location':state.currentLanguage==='ar'?'الموقع':'Location','completed':state.currentLanguage==='ar'?'تم الإنجاز':'Completed','duration':state.currentLanguage==='ar'?'المدة':'Duration','project_description':state.currentLanguage==='ar'?'وصف المشروع':'Project Description','project_gallery':state.currentLanguage==='ar'?'معرض المشروع':'Project Gallery','view_all_photos':state.currentLanguage==='ar'?'عرض جميع الصور':'View All Photos','interested_similar_project':state.currentLanguage==='ar'?'مهتم بمشروع مماثل؟':'Interested in a similar project?','book_now':state.currentLanguage==='ar'?'احجز الآن':'Book Now','get_quote':state.currentLanguage==='ar'?'احصل على عرض سعر':'Get Quote'};return translations[key]||key;}function formatDate(dateString){const date=new Date(dateString);const options={year:'numeric',month:'short'};return date.toLocaleDateString(state.currentLanguage==='ar'?'ar-AE':'en-US',options);}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.PortfolioModule={openProjectModal,closeProjectModal,openGalleryLightbox,closeLightbox,openBeforeAfterModal,closeBeforeAfterModal,filterProjects,resetFilters};})();;(function(){'use strict';const state={currentIndex:0,testimonialsData:[],autoplayInterval:null,autoplayDelay:5000,isAutoplayActive:true,slidesPerView:3,slideGap:30,isDragging:false,startPos:0,currentTranslate:0,prevTranslate:0,animationID:0};const elements={carousel:document.getElementById('testimonialsCarousel'),track:document.getElementById('carouselTrack'),prevBtn:document.getElementById('testimonialsPrev'),nextBtn:document.getElementById('testimonialsNext'),indicators:document.getElementById('carouselIndicators'),autoplayToggle:document.getElementById('autoplayToggle'),cards:null};function init(){if(!elements.carousel||!elements.track)return;loadTestimonialsData();calculateSlidesPerView();elements.cards=Array.from(elements.track.querySelectorAll('.testimonial-card'));if(elements.cards.length===0)return;createIndicators();attachEventListeners();updateCarousel();startAutoplay();}function loadTestimonialsData(){const dataElement=document.getElementById('testimonialsData');if(dataElement){try{state.testimonialsData=JSON.parse(dataElement.textContent);}catch(error){console.error('Error parsing testimonials data:',error);}}}function calculateSlidesPerView(){const width=window.innerWidth;if(width>=1024){state.slidesPerView=3;}else if(width>=768){state.slidesPerView=2;}else{state.slidesPerView=1;}}function createIndicators(){if(!elements.indicators)return;const totalSlides=elements.cards.length;const totalPages=Math.ceil(totalSlides/state.slidesPerView);elements.indicators.innerHTML='';for(let i=0;i<totalPages;i++){const dot=document.createElement('button');dot.className='indicator-dot';dot.setAttribute('aria-label',`Go to slide ${i+1}`);dot.addEventListener('click',()=>goToSlide(i*state.slidesPerView));elements.indicators.appendChild(dot);}}function attachEventListeners(){if(elements.prevBtn){elements.prevBtn.addEventListener('click',prevSlide);}if(elements.nextBtn){elements.nextBtn.addEventListener('click',nextSlide);}if(elements.autoplayToggle){elements.autoplayToggle.addEventListener('click',toggleAutoplay);}if(elements.carousel){elements.carousel.addEventListener('mouseenter',pauseAutoplay);elements.carousel.addEventListener('mouseleave',resumeAutoplay);}if(elements.track){elements.track.addEventListener('touchstart',touchStart);elements.track.addEventListener('touchmove',touchMove);elements.track.addEventListener('touchend',touchEnd);elements.track.addEventListener('mousedown',touchStart);elements.track.addEventListener('mousemove',touchMove);elements.track.addEventListener('mouseup',touchEnd);elements.track.addEventListener('mouseleave',touchEnd);elements.track.addEventListener('contextmenu',e=>e.preventDefault());}document.addEventListener('keydown',handleKeyboard);let resizeTimer;window.addEventListener('resize',()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(()=>{calculateSlidesPerView();createIndicators();updateCarousel();},250);});}function prevSlide(){state.currentIndex=Math.max(0,state.currentIndex-state.slidesPerView);updateCarousel();resetAutoplay();if(typeof trackEvent==='function'){trackEvent('testimonials_nav',{direction:'previous'});}}function nextSlide(){const maxIndex=elements.cards.length-state.slidesPerView;state.currentIndex=Math.min(maxIndex,state.currentIndex+state.slidesPerView);if(state.currentIndex>=maxIndex){state.currentIndex=0;}updateCarousel();resetAutoplay();if(typeof trackEvent==='function'){trackEvent('testimonials_nav',{direction:'next'});}}function goToSlide(index){state.currentIndex=Math.max(0,Math.min(index,elements.cards.length-state.slidesPerView));updateCarousel();resetAutoplay();}function updateCarousel(){if(!elements.track||elements.cards.length===0)return;const cardWidth=elements.cards[0].offsetWidth;const offset=-(state.currentIndex*(cardWidth+state.slideGap));elements.track.style.transform=`translateX(${offset}px)`;state.currentTranslate=offset;state.prevTranslate=offset;updateIndicators();updateNavButtons();}function updateIndicators(){if(!elements.indicators)return;const dots=elements.indicators.querySelectorAll('.indicator-dot');const currentPage=Math.floor(state.currentIndex/state.slidesPerView);dots.forEach((dot,index)=>{if(index===currentPage){dot.classList.add('active');}else{dot.classList.remove('active');}});}function updateNavButtons(){if(elements.prevBtn){if(state.currentIndex===0){elements.prevBtn.disabled=true;elements.prevBtn.style.opacity='0.5';}else{elements.prevBtn.disabled=false;elements.prevBtn.style.opacity='1';}}if(elements.nextBtn){const maxIndex=elements.cards.length-state.slidesPerView;if(state.currentIndex>=maxIndex){elements.nextBtn.style.opacity='0.5';}else{elements.nextBtn.style.opacity='1';}}}function touchStart(e){if(e.type==='mousedown'){e.preventDefault();}state.isDragging=true;state.startPos=getPositionX(e);state.animationID=requestAnimationFrame(animation);elements.track.style.cursor='grabbing';}function touchMove(e){if(!state.isDragging)return;const currentPosition=getPositionX(e);const diff=currentPosition-state.startPos;state.currentTranslate=state.prevTranslate+diff;}function touchEnd(){if(!state.isDragging)return;state.isDragging=false;cancelAnimationFrame(state.animationID);const movedBy=state.currentTranslate-state.prevTranslate;const threshold=100;if(movedBy<-threshold&&state.currentIndex<elements.cards.length-state.slidesPerView){nextSlide();}else if(movedBy>threshold&&state.currentIndex>0){prevSlide();}else{updateCarousel();}elements.track.style.cursor='grab';}function getPositionX(e){return e.type.includes('mouse')?e.pageX:e.touches[0].clientX;}function animation(){if(state.isDragging){setSliderPosition();requestAnimationFrame(animation);}}function setSliderPosition(){elements.track.style.transform=`translateX(${state.currentTranslate}px)`;}function handleKeyboard(e){if(!elements.carousel)return;const isCarouselVisible=isInViewport(elements.carousel);if(!isCarouselVisible)return;if(e.key==='ArrowLeft'){prevSlide();}else if(e.key==='ArrowRight'){nextSlide();}}function isInViewport(el){const rect=el.getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth));}function startAutoplay(){if(!state.isAutoplayActive)return;state.autoplayInterval=setInterval(()=>{nextSlide();},state.autoplayDelay);}function stopAutoplay(){if(state.autoplayInterval){clearInterval(state.autoplayInterval);state.autoplayInterval=null;}}function pauseAutoplay(){stopAutoplay();}function resumeAutoplay(){if(state.isAutoplayActive){startAutoplay();}}function resetAutoplay(){stopAutoplay();if(state.isAutoplayActive){startAutoplay();}}function toggleAutoplay(){state.isAutoplayActive=!state.isAutoplayActive;if(state.isAutoplayActive){startAutoplay();if(elements.autoplayToggle){elements.autoplayToggle.innerHTML='<i class="fa-solid fa-pause"></i>';}}else{stopAutoplay();if(elements.autoplayToggle){elements.autoplayToggle.innerHTML='<i class="fa-solid fa-play"></i>';}}if(typeof trackEvent==='function'){trackEvent('testimonials_autoplay',{active:state.isAutoplayActive});}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.TestimonialsModule={nextSlide,prevSlide,goToSlide,toggleAutoplay,pauseAutoplay,resumeAutoplay};})();;(function(){'use strict';const state={currentStep:1,totalSteps:6,servicesData:[],formData:{},pricing:{basePrice:0,hourlyRate:0,duration:0,urgencyMultiplier:1,subtotal:0,vat:0,total:0},uploadedFiles:[]};const elements={form:document.getElementById('bookingForm'),steps:null,progressSteps:null,progressFill:document.getElementById('progressFill'),prevBtn:document.getElementById('prevBtn'),nextBtn:document.getElementById('nextBtn'),submitBtn:document.getElementById('submitBtn'),bookingSuccess:document.getElementById('bookingSuccess'),bookingSummary:document.getElementById('bookingSummary'),newBookingBtn:document.getElementById('newBookingBtn'),quickQuote:document.getElementById('quickQuote'),closeQuote:document.getElementById('closeQuote'),fileUploadArea:document.getElementById('fileUploadArea'),fileInput:document.getElementById('photos'),filePreview:document.getElementById('filePreview')};function init(){if(!elements.form)return;loadServicesData();loadSavedProgress();elements.steps=Array.from(document.querySelectorAll('.wizard-step'));elements.progressSteps=Array.from(document.querySelectorAll('.progress-step'));attachEventListeners();updateUI();setupFileUpload();}function loadServicesData(){const dataElement=document.getElementById('bookingServicesData');if(dataElement){try{state.servicesData=JSON.parse(dataElement.textContent);}catch(error){console.error('Error parsing booking services data:',error);}}}function attachEventListeners(){if(elements.prevBtn){elements.prevBtn.addEventListener('click',previousStep);}if(elements.nextBtn){elements.nextBtn.addEventListener('click',nextStep);}if(elements.submitBtn){elements.submitBtn.addEventListener('click',submitForm);}if(elements.newBookingBtn){elements.newBookingBtn.addEventListener('click',resetForm);}const serviceInputs=document.querySelectorAll('input[name="service_id"]');serviceInputs.forEach(input=>{input.addEventListener('change',handleServiceChange);});const durationInput=document.getElementById('estimated_duration');if(durationInput){durationInput.addEventListener('change',calculatePrice);}const urgencyInput=document.getElementById('urgency');if(urgencyInput){urgencyInput.addEventListener('change',handleUrgencyChange);}elements.form.addEventListener('input',debounce(saveProgress,500));if(elements.closeQuote){elements.closeQuote.addEventListener('click',()=>{elements.quickQuote.classList.remove('active');});}elements.form.addEventListener('submit',(e)=>{e.preventDefault();submitForm();});if(elements.fileInput){elements.fileInput.addEventListener('change',handleFileSelect);}}function handleServiceChange(e){const selectedService=e.target;state.pricing.basePrice=parseFloat(selectedService.dataset.basePrice)||0;state.pricing.hourlyRate=parseFloat(selectedService.dataset.hourlyPrice)||0;state.formData.serviceName=selectedService.dataset.name;calculatePrice();updateQuickQuote();if(typeof trackEvent==='function'){trackEvent('booking_service_selected',{service_id:selectedService.value,service_name:state.formData.serviceName});}}function handleUrgencyChange(e){const urgency=e.target.value;switch(urgency){case 'priority':state.pricing.urgencyMultiplier=1.25;break;case 'emergency':state.pricing.urgencyMultiplier=1.5;break;default:state.pricing.urgencyMultiplier=1;}calculatePrice();updateQuickQuote();}function calculatePrice(){const duration=parseFloat(document.getElementById('estimated_duration')?.value)||0;state.pricing.duration=duration;const baseCharge=state.pricing.basePrice;const hourlyCharge=state.pricing.hourlyRate*duration;const subtotalBeforeUrgency=baseCharge+hourlyCharge;const urgencyCharge=subtotalBeforeUrgency*(state.pricing.urgencyMultiplier-1);state.pricing.subtotal=subtotalBeforeUrgency+urgencyCharge;state.pricing.vat=state.pricing.subtotal*0.05;state.pricing.total=state.pricing.subtotal+state.pricing.vat;updatePriceDisplay();updateQuickQuote();}function updatePriceDisplay(){const basePriceEl=document.getElementById('basePrice');const hourlyChargeEl=document.getElementById('hourlyCharge');const urgencyChargeEl=document.getElementById('urgencyCharge');const urgencyChargeItem=document.getElementById('urgencyChargeItem');const subtotalEl=document.getElementById('subtotal');const vatEl=document.getElementById('vatAmount');const totalEl=document.getElementById('totalPrice');if(basePriceEl)basePriceEl.textContent=`AED ${formatPrice(state.pricing.basePrice)}`;if(hourlyChargeEl){const hourlyTotal=state.pricing.hourlyRate*state.pricing.duration;hourlyChargeEl.textContent=`AED ${formatPrice(hourlyTotal)}`;}if(state.pricing.urgencyMultiplier>1){const urgencyAmount=(state.pricing.basePrice+(state.pricing.hourlyRate*state.pricing.duration))*(state.pricing.urgencyMultiplier-1);if(urgencyChargeEl)urgencyChargeEl.textContent=`AED ${formatPrice(urgencyAmount)}`;if(urgencyChargeItem)urgencyChargeItem.style.display='flex';}else{if(urgencyChargeItem)urgencyChargeItem.style.display='none';}if(subtotalEl)subtotalEl.textContent=`AED ${formatPrice(state.pricing.subtotal)}`;if(vatEl)vatEl.textContent=`AED ${formatPrice(state.pricing.vat)}`;if(totalEl)totalEl.textContent=`AED ${formatPrice(state.pricing.total)}`;}function updateQuickQuote(){const quoteService=document.getElementById('quoteService');const quoteDuration=document.getElementById('quoteDuration');const quoteUrgency=document.getElementById('quoteUrgency');const quoteTotal=document.getElementById('quoteTotal');if(quoteService&&state.formData.serviceName){quoteService.textContent=state.formData.serviceName;}if(quoteDuration&&state.pricing.duration>0){quoteDuration.textContent=`${state.pricing.duration}hour${state.pricing.duration>1?'s':''}`;}const urgencyValue=document.getElementById('urgency')?.value;if(quoteUrgency&&urgencyValue){const urgencyLabels={'regular':'Regular','priority':'Priority(+25%)','emergency':'Emergency(+50%)'};quoteUrgency.textContent=urgencyLabels[urgencyValue]||'-';}if(quoteTotal&&state.pricing.total>0){quoteTotal.textContent=`AED ${formatPrice(state.pricing.total)}`;elements.quickQuote.classList.add('active');}}function formatPrice(price){return price.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,',');}function nextStep(){if(!validateCurrentStep()){return;}if(state.currentStep<state.totalSteps){state.currentStep++;updateUI();saveProgress();if(typeof trackEvent==='function'){trackEvent('booking_step_completed',{step:state.currentStep-1});}if(state.currentStep===6){generateSummary();}}}function previousStep(){if(state.currentStep>1){state.currentStep--;updateUI();}}function validateCurrentStep(){const currentStepEl=elements.steps[state.currentStep-1];const inputs=currentStepEl.querySelectorAll('input[required],select[required],textarea[required]');let isValid=true;inputs.forEach(input=>{clearError(input);if(!input.value.trim()){showError(input,getTranslation('field_required'));isValid=false;}else if(input.type==='email'&&!isValidEmail(input.value)){showError(input,getTranslation('invalid_email'));isValid=false;}else if(input.type==='tel'&&!isValidPhone(input.value)){showError(input,getTranslation('invalid_phone'));isValid=false;}else if(input.type==='date'){const selectedDate=new Date(input.value);const today=new Date();today.setHours(0,0,0,0);if(selectedDate<today){showError(input,getTranslation('invalid_date_past'));isValid=false;}}});if(state.currentStep===1){const serviceSelected=document.querySelector('input[name="service_id"]:checked');if(!serviceSelected){showNotification(getTranslation('please_select_service'),'error');isValid=false;}}if(state.currentStep===6){const termsCheckbox=document.getElementById('terms_accepted');if(termsCheckbox&&!termsCheckbox.checked){showError(termsCheckbox,getTranslation('must_accept_terms'));isValid=false;}}return isValid;}function showError(input,message){const formGroup=input.closest('.form-group')||input.closest('.checkbox-label');if(formGroup){const errorEl=formGroup.querySelector('.form-error');if(errorEl){errorEl.textContent=message;errorEl.style.display='block';}input.classList.add('error');}}function clearError(input){const formGroup=input.closest('.form-group')||input.closest('.checkbox-label');if(formGroup){const errorEl=formGroup.querySelector('.form-error');if(errorEl){errorEl.textContent='';errorEl.style.display='none';}input.classList.remove('error');}}function isValidEmail(email){const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return re.test(email);}function isValidPhone(phone){const re=/^[\+]?[0-9]{10,15}$/;return re.test(phone.replace(/[\s\-]/g,''));}function updateUI(){elements.steps.forEach((step,index)=>{if(index+1===state.currentStep){step.classList.add('active');step.style.display='block';}else{step.classList.remove('active');step.style.display='none';}});elements.progressSteps.forEach((step,index)=>{if(index+1<state.currentStep){step.classList.add('completed');step.classList.remove('active');}else if(index+1===state.currentStep){step.classList.add('active');step.classList.remove('completed');}else{step.classList.remove('active','completed');}});const progress=((state.currentStep-1)/(state.totalSteps-1))*100;if(elements.progressFill){elements.progressFill.style.width=`${progress}%`;}updateNavigationButtons();const bookingSection=document.getElementById('booking');if(bookingSection){const headerOffset=100;const elementPosition=bookingSection.getBoundingClientRect().top;const offsetPosition=elementPosition+window.pageYOffset-headerOffset;window.scrollTo({top:offsetPosition,behavior:'smooth'});}}function updateNavigationButtons(){if(elements.prevBtn){if(state.currentStep===1){elements.prevBtn.style.display='none';}else{elements.prevBtn.style.display='inline-flex';}}if(elements.nextBtn){if(state.currentStep===state.totalSteps){elements.nextBtn.style.display='none';}else{elements.nextBtn.style.display='inline-flex';}}if(elements.submitBtn){if(state.currentStep===state.totalSteps){elements.submitBtn.style.display='inline-flex';}else{elements.submitBtn.style.display='none';}}}function generateSummary(){if(!elements.bookingSummary)return;const formData=new FormData(elements.form);let summaryHTML='';const serviceId=formData.get('service_id');const service=state.servicesData.find(s=>s.id==serviceId);const urgency=formData.get('urgency');summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-wrench"></i>${getTranslation('service_details')}</h4><div class="summary-item"><span>${getTranslation('service')}:</span><strong>${state.formData.serviceName||'-'}</strong></div><div class="summary-item"><span>${getTranslation('urgency')}:</span><strong>${capitalizeFirst(urgency||'-')}</strong></div></div>`;const bookingDate=formData.get('booking_date');const bookingTime=formData.get('booking_time');const duration=formData.get('estimated_duration');summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-calendar"></i>${getTranslation('date_time')}</h4><div class="summary-item"><span>${getTranslation('date')}:</span><strong>${formatDate(bookingDate)}</strong></div><div class="summary-item"><span>${getTranslation('time')}:</span><strong>${bookingTime||'-'}</strong></div><div class="summary-item"><span>${getTranslation('duration')}:</span><strong>${duration}${getTranslation('hours')}</strong></div></div>`;const emirate=formData.get('emirate');const area=formData.get('area');const propertyType=formData.get('property_type');const address=formData.get('address');summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-map-marker-alt"></i>${getTranslation('location')}</h4><div class="summary-item"><span>${getTranslation('emirate')}:</span><strong>${capitalizeFirst(emirate||'-')}</strong></div><div class="summary-item"><span>${getTranslation('area')}:</span><strong>${area||'-'}</strong></div><div class="summary-item"><span>${getTranslation('property_type')}:</span><strong>${capitalizeFirst(propertyType||'-')}</strong></div><div class="summary-item"><span>${getTranslation('address')}:</span><strong>${address||'-'}</strong></div></div>`;const clientName=formData.get('client_name');const clientEmail=formData.get('client_email');const clientPhone=formData.get('client_phone');const contactMethod=formData.get('contact_method');summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-user"></i>${getTranslation('contact_information')}</h4><div class="summary-item"><span>${getTranslation('name')}:</span><strong>${clientName||'-'}</strong></div><div class="summary-item"><span>${getTranslation('email')}:</span><strong>${clientEmail||'-'}</strong></div><div class="summary-item"><span>${getTranslation('phone')}:</span><strong>${clientPhone||'-'}</strong></div><div class="summary-item"><span>${getTranslation('preferred_contact')}:</span><strong>${capitalizeFirst(contactMethod||'-')}</strong></div></div>`;const issueDescription=formData.get('issue_description');if(issueDescription){summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-clipboard-list"></i>${getTranslation('issue_description')}</h4><p class="summary-description">${escapeHtml(issueDescription)}</p></div>`;}if(state.uploadedFiles.length>0){summaryHTML+=`<div class="summary-section"><h4><i class="fa-solid fa-images"></i>${getTranslation('uploaded_photos')}</h4><div class="summary-photos">${state.uploadedFiles.map(file=>`<div class="summary-photo"><img src="${file.preview}" alt="${file.name}"></div>`).join('')}</div></div>`;}elements.bookingSummary.innerHTML=summaryHTML;calculatePrice();}async function submitForm(){if(!validateCurrentStep()){return;}const formData=new FormData(elements.form);state.uploadedFiles.forEach((file,index)=>{formData.append(`photos[${index}]`,file.file);});formData.append('total_price',state.pricing.total);formData.append('vat_amount',state.pricing.vat);formData.append('subtotal',state.pricing.subtotal);elements.submitBtn.disabled=true;elements.submitBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i><span>'+getTranslation('submitting')+'...</span>';try{const response=await fetch(siteUrl('handlers/booking-handler.php'),{method:'POST',body:formData});const result=await response.json();if(result.success){showSuccessMessage(result.booking_reference);clearSavedProgress();if(typeof trackEvent==='function'){trackEvent('booking_submitted',{booking_reference:result.booking_reference,service_id:formData.get('service_id'),total_price:state.pricing.total});}}else{throw new Error(result.message||'Booking submission failed');}}catch(error){console.error('Booking submission error:',error);showNotification(error.message||getTranslation('booking_error'),'error');elements.submitBtn.disabled=false;elements.submitBtn.innerHTML='<i class="fa-solid fa-paper-plane"></i><span>'+getTranslation('submit_booking')+'</span>';}}function showSuccessMessage(bookingReference){elements.form.style.display='none';elements.bookingSuccess.style.display='block';const referenceEl=document.getElementById('bookingReference');if(referenceEl){referenceEl.textContent=bookingReference;}elements.bookingSuccess.scrollIntoView({behavior:'smooth',block:'center'});}function resetForm(){state.currentStep=1;state.formData={};state.pricing={basePrice:0,hourlyRate:0,duration:0,urgencyMultiplier:1,subtotal:0,vat:0,total:0};state.uploadedFiles=[];elements.form.reset();if(elements.filePreview){elements.filePreview.innerHTML='';}elements.bookingSuccess.style.display='none';elements.form.style.display='block';updateUI();clearSavedProgress();const bookingSection=document.getElementById('booking');if(bookingSection){bookingSection.scrollIntoView({behavior:'smooth'});}}function setupFileUpload(){if(!elements.fileUploadArea)return;elements.fileUploadArea.addEventListener('dragover',(e)=>{e.preventDefault();elements.fileUploadArea.classList.add('drag-over');});elements.fileUploadArea.addEventListener('dragleave',()=>{elements.fileUploadArea.classList.remove('drag-over');});elements.fileUploadArea.addEventListener('drop',(e)=>{e.preventDefault();elements.fileUploadArea.classList.remove('drag-over');const files=e.dataTransfer.files;handleFiles(files);});}function handleFileSelect(e){const files=e.target.files;handleFiles(files);}function handleFiles(files){const maxFiles=5;const maxSize=5*1024*1024;const allowedTypes=['image/jpeg','image/png','image/webp'];Array.from(files).forEach(file=>{if(state.uploadedFiles.length>=maxFiles){showNotification(getTranslation('max_files_exceeded'),'warning');return;}if(file.size>maxSize){showNotification(`${file.name}:${getTranslation('file_too_large')}`,'warning');return;}if(!allowedTypes.includes(file.type)){showNotification(`${file.name}:${getTranslation('invalid_file_type')}`,'warning');return;}const reader=new FileReader();reader.onload=(e)=>{const fileData={file:file,name:file.name,preview:e.target.result};state.uploadedFiles.push(fileData);addFilePreview(fileData);};reader.readAsDataURL(file);});}function addFilePreview(fileData){if(!elements.filePreview)return;const previewItem=document.createElement('div');previewItem.className='file-preview-item';previewItem.innerHTML=`<img src="${fileData.preview}" alt="${fileData.name}"><div class="file-info"><span class="file-name">${fileData.name}</span></div><button type="button" class="remove-file" data-name="${fileData.name}"><i class="fa-solid fa-times"></i></button>`;const removeBtn=previewItem.querySelector('.remove-file');removeBtn.addEventListener('click',()=>{removeFile(fileData.name);previewItem.remove();});elements.filePreview.appendChild(previewItem);}function removeFile(fileName){state.uploadedFiles=state.uploadedFiles.filter(f=>f.name!==fileName);}function saveProgress(){const formData=new FormData(elements.form);const data={};for(let[key,value]of formData.entries()){data[key]=value;}data.currentStep=state.currentStep;data.pricing=state.pricing;sessionStorage.setItem('bookingProgress',JSON.stringify(data));}function loadSavedProgress(){const saved=sessionStorage.getItem('bookingProgress');if(!saved)return;try{const data=JSON.parse(saved);Object.keys(data).forEach(key=>{if(key==='currentStep'||key==='pricing')return;const input=elements.form.elements[key];if(input){if(input.type==='radio'){const radioInput=elements.form.querySelector(`input[name="${key}"][value="${data[key]}"]`);if(radioInput)radioInput.checked=true;}else if(input.type==='checkbox'){input.checked=data[key]==='on';}else{input.value=data[key];}}});if(data.currentStep){state.currentStep=data.currentStep;}if(data.pricing){state.pricing=data.pricing;}updateUI();}catch(error){console.error('Error loading saved progress:',error);}}function clearSavedProgress(){sessionStorage.removeItem('bookingProgress');}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}function capitalizeFirst(str){if(!str)return '';return str.charAt(0).toUpperCase()+str.slice(1).replace(/_/g,' ');}function formatDate(dateStr){if(!dateStr)return '-';const date=new Date(dateStr);return date.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});}function escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML;}function getTranslation(key){return key.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase());}function showNotification(message,type='info'){if(typeof window.showNotification==='function'){window.showNotification(message,type);}else{alert(message);}}function siteUrl(path){return window.SITE_URL?window.SITE_URL+'/'+path:path;}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.BookingModule={nextStep,previousStep,resetForm,calculatePrice};})();;