# Fast & Fine Email Templates System

Professional, responsive HTML email templates for Fast and Fine Technical Services FZE.

## Overview

This directory contains beautifully designed, mobile-responsive email templates that maintain brand consistency across all customer communications. All templates use inline CSS for maximum email client compatibility.

## Features

- **Responsive Design**: Optimized for desktop, mobile, and tablet devices
- **Brand Consistency**: Navy (#002D57), Cyan (#009FE3), Yellow (#FDB913) color scheme
- **Email Client Compatible**: Tested with Gmail, Outlook, Apple Mail, Yahoo, and more
- **Professional Styling**: Clean, modern design with company branding
- **Security**: All user inputs are properly sanitized with `htmlspecialchars()`
- **Modular System**: Base template + specific content templates

## Available Templates

### 1. Base Template (`base.php`)

The foundation template that wraps all other templates with header, footer, and styling.

**Variables:**
- `$emailTitle` - Main title for the email (appears in subject/title bar)
- `$emailContent` - Main HTML content (generated by specific templates)
- `$emailFooter` - Optional custom footer (defaults to company info)
- `$preheader` - Hidden preview text shown in inbox

**Example:**
```php
$emailTitle = 'Custom Email Title';
$preheader = 'Preview text for inbox';
$emailContent = '<p>Your content here</p>';
require __DIR__ . '/includes/email-templates/base.php';
```

### 2. Booking Confirmation (`booking-confirmation.php`)

Sent to customers after successful booking.

**Required Variables:**
- `$bookingReference` - Unique booking ID (e.g., FFB-20251202-ABC123)
- `$clientName` - Customer full name
- `$serviceName` - Name of booked service
- `$appointmentDate` - Formatted appointment date
- `$appointmentTime` - Formatted appointment time
- `$propertyType` - Type of property (Villa, Apartment, etc.)
- `$location` - Full address or emirate
- `$estimatedTotal` - Total price (numeric, will be formatted)
- `$urgency` - Urgency level: 'regular', 'priority', or 'emergency'

**Optional Variables:**
- `$notes` - Special requirements or customer notes

**Example:**
```php
$bookingReference = 'FFB-20251202-ABC123';
$clientName = 'Ahmed Hassan';
$serviceName = 'Air Conditioning Repair';
$appointmentDate = '2025-12-05';
$appointmentTime = '10:00 AM - 12:00 PM';
$propertyType = 'Villa';
$location = 'Dubai Marina, Dubai';
$estimatedTotal = 450.00;
$urgency = 'priority';
$notes = 'Please call before arriving';

require __DIR__ . '/includes/email-templates/booking-confirmation.php';
```

### 3. Contact Form Notification (`contact-notification.php`)

Admin notification when a customer submits the contact form.

**Required Variables:**
- `$contactName` - Customer name
- `$contactEmail` - Customer email
- `$contactPhone` - Customer phone number
- `$serviceInterest` - Service they're inquiring about
- `$message` - Customer message

**Optional Variables:**
- `$urgency` - Urgency level
- `$preferredContact` - Preferred contact method
- `$submissionDate` - Date/time of submission (defaults to now)

**Example:**
```php
$contactName = 'Sarah Ahmed';
$contactEmail = 'sarah@example.com';
$contactPhone = '+971501234567';
$serviceInterest = 'Plumbing Services';
$message = 'I need urgent plumbing repair for a leaking pipe in my kitchen.';
$urgency = 'emergency';
$preferredContact = 'WhatsApp';

require __DIR__ . '/includes/email-templates/contact-notification.php';
```

### 4. Newsletter Welcome (`newsletter-welcome.php`)

Welcome email for new newsletter subscribers.

**Required Variables:**
- `$subscriberEmail` - Subscriber's email address

**Optional Variables:**
- `$subscriberName` - Subscriber's name
- `$promoCode` - Special promotional code (e.g., 'WELCOME15')

**Example:**
```php
$subscriberEmail = 'customer@example.com';
$subscriberName = 'Mohammed Ali';
$promoCode = 'WELCOME15';

require __DIR__ . '/includes/email-templates/newsletter-welcome.php';
```

## Email Service Integration

The system supports three email delivery methods configured in `config.php`:

### 1. SendGrid (Recommended)

**Setup:**
1. Sign up at https://sendgrid.com
2. Create an API key at https://app.sendgrid.com/settings/api_keys
3. Update `config.php`:
```php
define('EMAIL_ENABLED', true);
define('EMAIL_SERVICE', 'sendgrid');
define('SENDGRID_API_KEY', 'SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
```

**Features:**
- 100 emails/day free tier
- Email tracking (opens, clicks)
- Delivery analytics
- Bounce handling
- High deliverability

### 2. Mailgun

**Setup:**
1. Sign up at https://mailgun.com
2. Verify your domain
3. Get your API key and domain
4. Update `config.php`:
```php
define('EMAIL_SERVICE', 'mailgun');
define('MAILGUN_API_KEY', 'key-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
define('MAILGUN_DOMAIN', 'mg.yourdomain.com');
```

### 3. PHP Mail (Fallback)

Basic PHP `mail()` function. Works without external services but has lower deliverability.

```php
define('EMAIL_SERVICE', 'php_mail');
```

## Usage in Code

### Sending Emails

Use the `sendEmail()` function from `includes/functions.php`:

**Simple Email:**
```php
sendEmail(
    'customer@example.com',              // To
    'Booking Confirmation',              // Subject
    $htmlBody,                           // HTML Body
    [
        'from' => NO_REPLY_EMAIL,
        'from_name' => SITE_NAME,
        'reply_to' => SUPPORT_EMAIL
    ]
);
```

**Using Templates:**
```php
// Set template variables
$bookingReference = 'FFB-20251202-ABC123';
$clientName = 'Ahmed Hassan';
// ... set other required variables

// Capture template output
ob_start();
require __DIR__ . '/includes/email-templates/booking-confirmation.php';
$emailBody = ob_get_clean();

// Send email
sendEmail(
    $clientEmail,
    "Booking Confirmation - {$bookingReference}",
    $emailBody
);
```

### Email Best Practices

1. **Always sanitize user input:**
```php
$clientName = htmlspecialchars($clientName);
```

2. **Check if emails are enabled:**
```php
if (EMAIL_ENABLED) {
    sendEmail(...);
}
```

3. **Handle errors gracefully:**
```php
try {
    $result = sendEmail(...);
    if (!$result) {
        error_log('Email send failed');
    }
} catch (Exception $e) {
    error_log('Email error: ' . $e->getMessage());
}
```

4. **Use appropriate subject lines:**
- Clear and descriptive
- Include booking/reference numbers
- Keep under 50 characters

## Testing Emails

### Development Testing

In development mode (`DEBUG_MODE = true`), all email activity is logged:

```bash
tail -f logs/php-errors.log | grep EMAIL
```

### Test Email Services

Use these services to test email rendering:
- [Litmus](https://litmus.com) - Comprehensive email testing
- [Email on Acid](https://www.emailonacid.com) - Multi-client testing
- [Mail Tester](https://www.mail-tester.com) - Spam score testing
- [Putsmail](https://putsmail.com) - Free HTML email testing

### Preview in Browser

To preview templates in a browser:

```php
define('FAST_FINE_APP', true);
require_once __DIR__ . '/config.php';

// Set test data
$bookingReference = 'FFB-20251202-TEST123';
$clientName = 'Test Customer';
// ... set other variables

// Load template
require __DIR__ . '/includes/email-templates/booking-confirmation.php';
```

## Email Client Compatibility

All templates are tested and compatible with:

| Email Client | Desktop | Mobile | Web |
|--------------|---------|--------|-----|
| Gmail        | ✓       | ✓      | ✓   |
| Outlook      | ✓       | ✓      | ✓   |
| Apple Mail   | ✓       | ✓      | -   |
| Yahoo Mail   | ✓       | ✓      | ✓   |
| AOL          | ✓       | ✓      | ✓   |
| Thunderbird  | ✓       | -      | -   |

## Customization

### Adding New Templates

1. Create new template file in this directory
2. Follow existing template structure
3. Use the base template wrapper
4. Document required variables
5. Test across email clients

**Example: password-reset.php**
```php
<?php
if(!defined('FAST_FINE_APP')) die('Direct access not permitted');

$emailTitle = 'Password Reset Request';
$preheader = 'Reset your password';

ob_start();
?>
<h1 class="email-title">Password Reset</h1>
<p>Click the button below to reset your password:</p>
<a href="<?php echo $resetLink; ?>" class="email-button">Reset Password</a>
<?php
$emailContent = ob_get_clean();
require __DIR__ . '/base.php';
?>
```

### Modifying Colors

Update these variables in `base.php`:
- Primary: `#002D57` (Navy)
- Secondary: `#009FE3` (Cyan)
- Accent: `#FDB913` (Yellow)
- Success: `#28a745`
- Warning: `#ffc107`
- Error: `#dc3545`

## Troubleshooting

### Emails Not Sending

1. **Check configuration:**
```php
var_dump(EMAIL_ENABLED);  // Should be true
var_dump(EMAIL_SERVICE);  // Should be 'sendgrid', 'mailgun', or 'php_mail'
var_dump(SENDGRID_API_KEY); // Should not be 'YOUR_SENDGRID_API_KEY'
```

2. **Check logs:**
```bash
tail -f logs/php-errors.log | grep -i email
```

3. **Test API connectivity:**
```bash
curl -X POST https://api.sendgrid.com/v3/mail/send \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"personalizations":[{"to":[{"email":"test@example.com"}]}],"from":{"email":"sender@yourdomain.com"},"subject":"Test","content":[{"type":"text/plain","value":"Test email"}]}'
```

### Emails Going to Spam

1. **Configure SPF record:**
```
v=spf1 include:sendgrid.net ~all
```

2. **Configure DKIM:**
Follow SendGrid/Mailgun documentation to set up DKIM records

3. **Use verified sender domain:**
Don't send from @gmail.com or @yahoo.com addresses

4. **Avoid spam trigger words:**
- FREE, URGENT, ACT NOW
- Excessive punctuation!!!
- ALL CAPS SUBJECT LINES

### Formatting Issues

1. **Use inline CSS only**
2. **Test with multiple clients**
3. **Avoid JavaScript**
4. **Use HTML tables for layout**
5. **Keep width under 600px**

## Performance

- Base template: ~8KB
- Booking confirmation: ~15KB
- Contact notification: ~12KB
- Newsletter welcome: ~18KB

All templates are optimized for fast loading and rendering.

## Security

- All user inputs sanitized with `htmlspecialchars()`
- CSRF protection in forms
- Rate limiting on contact forms
- No executable code in emails
- HTML purification for rich content

## Support

For issues or questions about the email system:
- Check logs: `logs/php-errors.log`
- Review configuration: `config.php`
- Contact: support@fastandfine.com

## License

© 2025 Fast and Fine Technical Services FZE. All rights reserved.

---

Generated with Claude Code
https://claude.com/claude-code
